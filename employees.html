document.addEventListener("DOMContentLoaded", function () {
    let job = JSON.parse(localStorage.getItem("selectedJob"));
    let jobIndex = localStorage.getItem("selectedJobIndex");
    let employees = JSON.parse(localStorage.getItem("employees")) || [];

    function saveEmployees() {
        employees[jobIndex] = job;
        localStorage.setItem("employees", JSON.stringify(employees));
    }

    function displayEmployees() {
        let employeeList = document.getElementById("employee-list");
        let totalSalaryEl = document.getElementById("total-salary");
        employeeList.innerHTML = "";

        let totalSalary = 0;
        job.employees.forEach((employee, index) => {
            totalSalary += employee.salary;

            let row = document.createElement("tr");
            row.innerHTML = `
                <td>${employee.id}</td>
                <td>${employee.name}</td>
                <td>${employee.location}</td>
                <td>${employee.job}</td>
                <td>${employee.date}</td>
                <td>${employee.visa}</td>
                <td>${employee.salary} ريال</td>
                <td>
                    <button onclick="editEmployee(${index})">تعديل</button>
                    <button onclick="deleteEmployee(${index})">حذف</button>
                </td>
            `;
            employeeList.appendChild(row);
        });

        totalSalaryEl.textContent = `إجمالي الراتب: ${totalSalary} ريال`;
    }

    window.editEmployee = function (index) {
        let employee = job.employees[index];
        let newName = prompt("أدخل الاسم الجديد:", employee.name);
        let newLocation = prompt("أدخل الموقع الجديد:", employee.location);
        let newSalary = prompt("أدخل الراتب الجديد:", employee.salary);

        if (newName) employee.name = newName;
        if (newLocation) employee.location = newLocation;
        if (newSalary) employee.salary = parseFloat(newSalary);

        saveEmployees();
        displayEmployees();
    };

    window.deleteEmployee = function (index) {
        job.employees.splice(index, 1);
        saveEmployees();
        displayEmployees();
    };

    document.getElementById("go-back").addEventListener("click", function () {
        window.location.href = "index.html";
    });

    displayEmployees();
});
